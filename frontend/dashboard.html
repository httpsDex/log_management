<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IT Office — Dashboard</title>
  <link rel="stylesheet" href="css/main.css"/>
</head>
<body>

<!-- Backdrop -->
<div class="sidebar-backdrop" id="sidebarBackdrop" onclick="closeSidebar()"></div>

<!-- ══════ SIDEBAR ══════ -->
<aside class="sidebar" id="sidebar">
  <button class="sidebar-close-btn" onclick="closeSidebar()" aria-label="Close menu">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
  </button>

  <div class="sidebar-logo">
    <div style="display:flex;align-items:center;gap:11px;">
      <div class="logo-badge">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/>
        </svg>
      </div>
      <div>
        <div class="logo-title">IT Office</div>
        <div class="logo-sub">LOGS SYSTEM v2</div>
      </div>
    </div>
  </div>

  <div class="nav-section">
    <div class="nav-label">Overview</div>
    <div class="nav-item" data-tab="dashboard" onclick="switchTab('dashboard')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h4a1 1 0 011 1v5a1 1 0 01-1 1H5a1 1 0 01-1-1V5zm10 0a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 15a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1v-4zm10-3a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1v-7z"/></svg>
      Dashboard
    </div>
  </div>

  <div class="nav-section">
    <div class="nav-label">Repairs</div>
    <div class="nav-item" data-tab="repairLogs" onclick="switchTab('repairLogs')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
      Repair Logs
    </div>
    <div class="nav-item" data-tab="repairHistory" onclick="switchTab('repairHistory')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
      Repair History
    </div>
  </div>

  <div class="nav-section">
    <div class="nav-label">Borrowing</div>
    <div class="nav-item" data-tab="borrowLogs" onclick="switchTab('borrowLogs')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
      Borrow Logs
    </div>
    <div class="nav-item" data-tab="returnHistory" onclick="switchTab('returnHistory')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/></svg>
      Returned Items
    </div>
  </div>

  <div class="sidebar-footer">
    <div style="display:flex;align-items:center;gap:9px;">
      <div class="user-badge" id="userInitial">A</div>
      <div>
        <div style="font-size:.78rem;font-weight:600;color:white;" id="sidebarUsername">Admin</div>
        <div style="font-size:.62rem;color:var(--muted);display:flex;align-items:center;gap:5px;">
          <span class="pulse-dot"></span> Online
        </div>
      </div>
    </div>
    <button class="btn-logout" onclick="logout()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
      Sign Out
    </button>
  </div>
</aside>

<!-- ══════ MAIN ══════ -->
<main class="main">
  <!-- Mobile topbar -->
  <div class="mobile-topbar">
    <button class="mobile-menu-btn" onclick="openSidebar()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
    </button>
    <span style="font-weight:700;font-size:.92rem;" id="mobileTitleBar">Dashboard</span>
  </div>

  <div class="main-inner">
    <!-- Desktop header -->
    <div class="page-header desktop-header">
      <div class="page-title" id="pageTitle">Dashboard</div>
      <div class="page-sub"   id="pageSubtitle">Overview of all IT office activities</div>
    </div>

    <!-- ══ TAB: DASHBOARD ══ -->
    <div id="tab-dashboard" class="tab-content active">

      <!-- Top stats row -->
      <div class="stats-grid">
        <div class="stat-card blue">
          <div class="stat-icon" style="background:rgba(59,130,246,0.12);color:#60a5fa;">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
          </div>
          <div class="stat-label">Total Repairs</div>
          <div class="stat-value" style="color:#60a5fa;" id="ds-total-repairs">—</div>
          <div class="stat-change">All time</div>
        </div>

        <div class="stat-card amber">
          <div class="stat-icon" style="background:rgba(245,158,11,0.12);color:#fbbf24;">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div>
          <div class="stat-label">Pending Repairs</div>
          <div class="stat-value" style="color:#fbbf24;" id="ds-pending-repairs">—</div>
          <div class="stat-change">Awaiting service</div>
        </div>

        <div class="stat-card green">
          <div class="stat-icon" style="background:rgba(16,185,129,0.12);color:#34d399;">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
          </div>
          <div class="stat-label">Total Borrowed</div>
          <div class="stat-value" style="color:#34d399;" id="ds-total-borrowed">—</div>
          <div class="stat-change">All time</div>
        </div>

        <div class="stat-card purple">
          <div class="stat-icon" style="background:rgba(168,85,247,0.12);color:#c084fc;">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/></svg>
          </div>
          <div class="stat-label">Pending Returns</div>
          <div class="stat-value" style="color:#c084fc;" id="ds-pending-borrows">—</div>
          <div class="stat-change">Awaiting return</div>
        </div>
      </div>

      <!-- Second stats row -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:16px;">
        <div class="stat-card green" style="padding:14px 18px;">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <div>
              <div class="stat-label">Items Released</div>
              <div class="stat-value" style="color:#34d399;font-size:1.5rem;" id="ds-released">—</div>
            </div>
            <div style="font-size:1.8rem;">✓</div>
          </div>
        </div>
        <div class="stat-card blue" style="padding:14px 18px;">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <div>
              <div class="stat-label">Items Returned</div>
              <div class="stat-value" style="color:#60a5fa;font-size:1.5rem;" id="ds-returned">—</div>
            </div>
            <div style="font-size:1.8rem;">↩</div>
          </div>
        </div>
      </div>

      <!-- Dashboard main grid -->
      <div class="dashboard-grid">
        <!-- Activity feed -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">Recent Activity</span>
            <div style="display:flex;align-items:center;gap:6px;">
              <span class="pulse-dot"></span>
              <span style="font-size:.68rem;color:var(--muted);">Live</span>
            </div>
          </div>
          <ul class="activity-feed" id="activity-feed">
            <li style="padding:40px;text-align:center;color:var(--muted);font-size:.8rem;">Loading...</li>
          </ul>
        </div>

        <!-- Right column -->
        <div>
          <!-- Donut chart -->
          <div class="card" style="margin-bottom:16px;">
            <div class="card-header">
              <span class="card-title">Repair Status</span>
            </div>
            <div class="ring-container">
              <div class="donut-chart">
                <svg viewBox="0 0 120 120" width="120" height="120">
                  <circle cx="60" cy="60" r="45" fill="none" stroke="var(--border)" stroke-width="10"/>
                  <g id="donut-svg"></g>
                </svg>
                <div class="donut-center">
                  <div class="donut-center-value" id="donut-total">0</div>
                  <div class="donut-center-label">Total</div>
                </div>
              </div>
              <ul class="legend" id="donut-legend"></ul>
            </div>
          </div>

          <!-- Office bar chart -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">By Office</span>
              <span class="card-sub">Requests</span>
            </div>
            <div class="bar-chart" id="office-bars">
              <div style="text-align:center;color:var(--muted);font-size:.8rem;padding:20px;">Loading...</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ TAB: REPAIR LOGS ══ -->
    <div id="tab-repairLogs" class="tab-content">
      <div class="stats-grid">
        <div class="stat-card amber">
          <div class="stat-label">Pending</div>
          <div class="stat-value" style="color:var(--warn)" id="stat-pending">—</div>
        </div>
        <div class="stat-card green">
          <div class="stat-label">Fixed</div>
          <div class="stat-value" style="color:var(--success)" id="stat-fixed">—</div>
        </div>
        <div class="stat-card red">
          <div class="stat-label">Unserviceable</div>
          <div class="stat-value" style="color:var(--danger)" id="stat-unserviceable">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Released</div>
          <div class="stat-value" style="color:var(--info)" id="stat-released">—</div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-title">Pending for Repair</span>
          <button class="btn btn-primary btn-sm" onclick="openModal('newRepairModal')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            New Repair
          </button>
        </div>
        <div class="table-wrap">
          <table class="data-table">
            <thead><tr>
              <th>#</th><th>Customer</th><th>Office</th><th>Item</th><th>Specs</th><th>Qty</th><th>Problem</th><th>Received By</th><th>Date</th><th>Status</th><th>Action</th>
            </tr></thead>
            <tbody id="pendingRepairsBody"><tr><td colspan="11"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-title">Ready for Release</span>
          <span style="font-size:.72rem;color:var(--muted);">Fixed &amp; Unserviceable items</span>
        </div>
        <div class="table-wrap">
          <table class="data-table">
            <thead><tr>
              <th>#</th><th>Customer</th><th>Office</th><th>Item</th><th>Repaired By</th><th>Comment</th><th>Status</th><th>Action</th>
            </tr></thead>
            <tbody id="releaseBody"><tr><td colspan="8"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ══ TAB: REPAIR HISTORY ══ -->
    <div id="tab-repairHistory" class="tab-content">
      <div class="card">
        <div class="card-header">
          <span class="card-title">Repair History</span>
          <span class="badge badge-released">Released</span>
        </div>
        <div class="table-wrap">
          <table class="data-table">
            <thead><tr>
              <th>#</th><th>Customer</th><th>Office</th><th>Item</th><th>Specs</th><th>Problem</th><th>Repaired By</th><th>Claimed By</th><th>Released By</th><th>Date Released</th><th>Status</th><th>Action</th>
            </tr></thead>
            <tbody id="repairHistoryBody"><tr><td colspan="12"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ══ TAB: BORROW LOGS ══ -->
    <div id="tab-borrowLogs" class="tab-content">
      <div class="stats-grid stats-grid-2" style="max-width:400px;margin-bottom:16px;">
        <div class="stat-card amber">
          <div class="stat-label">Pending Returns</div>
          <div class="stat-value" style="color:var(--warn)" id="stat-borrow-pending">—</div>
        </div>
        <div class="stat-card green">
          <div class="stat-label">Returned</div>
          <div class="stat-value" style="color:var(--success)" id="stat-borrow-returned">—</div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <span class="card-title">Pending Borrowed Items</span>
          <button class="btn btn-primary btn-sm" onclick="openModal('newBorrowModal')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            New Borrow
          </button>
        </div>
        <div class="table-wrap">
          <table class="data-table">
            <thead><tr>
              <th>#</th><th>Borrower</th><th>Office</th><th>Item</th><th>Qty</th><th>Released By</th><th>Date Borrowed</th><th>Status</th><th>Action</th>
            </tr></thead>
            <tbody id="pendingBorrowBody"><tr><td colspan="9"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ══ TAB: RETURN HISTORY ══ -->
    <div id="tab-returnHistory" class="tab-content">
      <div class="card">
        <div class="card-header">
          <span class="card-title">Returned Items History</span>
          <span class="badge badge-returned">Returned</span>
        </div>
        <div class="table-wrap">
          <table class="data-table">
            <thead><tr>
              <th>#</th><th>Borrower</th><th>Office</th><th>Item</th><th>Qty</th><th>Returned By</th><th>Received By</th><th>Return Date</th><th>Comments</th><th>Status</th><th>Action</th>
            </tr></thead>
            <tbody id="returnHistoryBody"><tr><td colspan="11"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

  </div><!-- .main-inner -->
</main>

<!-- ══════════════ MODALS ══════════════ -->

<!-- NEW REPAIR -->
<div class="modal-overlay hidden" id="newRepairModal">
  <div class="modal-box">
    <div class="modal-header">
      <span class="modal-title">New Repair Entry</span>
      <button class="modal-close" onclick="closeModal('newRepairModal')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div id="newRepairAlert"></div>
      <form id="newRepairForm">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Customer Name *</label>
            <input type="text" name="customer_name" class="form-input" placeholder="Full name"/>
          </div>
          <div class="form-group">
            <label class="form-label">Contact Number
              <span style="font-size:.58rem;color:var(--muted);font-weight:400;letter-spacing:.04em;margin-left:4px;">will be encrypted</span>
            </label>
            <input type="tel" name="contact_number" class="form-input" placeholder="e.g. 09171234567"/>
          </div>
          <div class="form-group">
            <label class="form-label">Office *</label>
            <select name="office_select" class="form-input" id="repairOfficeSelect" onchange="toggleOtherInput(this,'repairOfficeOther')">
              <option value="">Select office...</option>
            </select>
            <input type="text" name="office_other" class="form-input" id="repairOfficeOther" placeholder="Type office name" style="display:none;margin-top:6px;"/>
          </div>
          <div class="form-group">
            <label class="form-label">Item Name *</label>
            <input type="text" name="item_name" class="form-input" placeholder="e.g. Printer, Laptop"/>
          </div>
          <div class="form-group">
            <label class="form-label">Model / Specs</label>
            <input type="text" name="serial_specs" class="form-input" placeholder="e.g. L3210, Core i5 8GB"/>
          </div>
          <div class="form-group">
            <label class="form-label">Quantity *</label>
            <input type="number" name="quantity" class="form-input" min="1" value="1"/>
          </div>
          <div class="form-group">
            <label class="form-label">Date Received *</label>
            <input type="date" name="date_received" class="form-input" id="repairDateInput"/>
          </div>
          <div class="form-group span-2">
            <label class="form-label">Received By *</label>
            <select name="received_by_select" class="form-input" id="repairReceivedBySelect" onchange="toggleOjtInput(this,'repairReceivedByOjt')">
              <option value="">Select employee...</option>
            </select>
            <input type="text" name="received_by_ojt" class="form-input" id="repairReceivedByOjt" placeholder="Enter OJT trainee name" style="display:none;margin-top:6px;"/>
          </div>
          <div class="form-group span-2">
            <label class="form-label">Problem Description *</label>
            <textarea name="problem_description" class="form-input" placeholder="Describe the issue in detail..."></textarea>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-ghost" onclick="closeModal('newRepairModal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Entry</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- UPDATE STATUS -->
<div class="modal-overlay hidden" id="updateStatusModal">
  <div class="modal-box">
    <div class="modal-header">
      <span class="modal-title">Update Repair Status</span>
      <button class="modal-close" onclick="closeModal('updateStatusModal')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div id="updateStatusAlert"></div>
      <input type="hidden" id="updateRepairId"/>
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Status *</label>
          <select id="updateStatus" class="form-input">
            <option value="Fixed">Fixed</option>
            <option value="Unserviceable">Unserviceable</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Repaired By *</label>
          <select id="updateRepairedBySelect" class="form-input" onchange="toggleOjtInput(this,'updateRepairedByOjt')">
            <option value="">Select employee...</option>
          </select>
          <input type="text" id="updateRepairedByOjt" class="form-input" placeholder="OJT trainee name" style="display:none;margin-top:6px;"/>
        </div>
        <div class="form-group span-2">
          <label class="form-label">Comment</label>
          <textarea id="repairComment" class="form-input" placeholder="Optional notes about the repair..."></textarea>
        </div>
      </div>
      <div class="form-actions">
        <button class="btn btn-ghost" onclick="closeModal('updateStatusModal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitUpdateStatus()">Update Status</button>
      </div>
    </div>
  </div>
</div>

<!-- RELEASE -->
<div class="modal-overlay hidden" id="releaseModal">
  <div class="modal-box">
    <div class="modal-header">
      <span class="modal-title">Release Item</span>
      <button class="modal-close" onclick="closeModal('releaseModal')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div id="releaseAlert"></div>
      <input type="hidden" id="releaseRepairId"/>
      <div class="form-grid">
        <div class="form-group span-2">
          <label class="form-label">Claimed By *</label>
          <input type="text" id="claimedBy" class="form-input" placeholder="Name of person claiming the item"/>
        </div>
        <div class="form-group">
          <label class="form-label">Date Claimed</label>
          <input type="date" id="dateClaimed" class="form-input"/>
        </div>
        <div class="form-group">
          <label class="form-label">Released By *</label>
          <select id="releaseReleasedBySelect" class="form-input" onchange="toggleOjtInput(this,'releaseReleasedByOjt')">
            <option value="">Select employee...</option>
          </select>
          <input type="text" id="releaseReleasedByOjt" class="form-input" placeholder="OJT trainee name" style="display:none;margin-top:6px;"/>
        </div>
      </div>
      <div class="form-actions">
        <button class="btn btn-ghost" onclick="closeModal('releaseModal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitRelease()">Confirm Release</button>
      </div>
    </div>
  </div>
</div>

<!-- NEW BORROW -->
<div class="modal-overlay hidden" id="newBorrowModal">
  <div class="modal-box">
    <div class="modal-header">
      <span class="modal-title">New Borrow Entry</span>
      <button class="modal-close" onclick="closeModal('newBorrowModal')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div id="newBorrowAlert"></div>
      <form id="newBorrowForm">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Borrower Name *</label>
            <input type="text" name="borrower_name" class="form-input" placeholder="Full name"/>
          </div>
          <div class="form-group">
            <label class="form-label">Contact Number
              <span style="font-size:.58rem;color:var(--muted);font-weight:400;letter-spacing:.04em;margin-left:4px;">will be encrypted</span>
            </label>
            <input type="tel" name="contact_number" class="form-input" placeholder="e.g. 09171234567"/>
          </div>
          <div class="form-group">
            <label class="form-label">Office *</label>
            <select name="office_select" class="form-input" id="borrowOfficeSelect" onchange="toggleOtherInput(this,'borrowOfficeOther')">
              <option value="">Select office...</option>
            </select>
            <input type="text" name="office_other" class="form-input" id="borrowOfficeOther" placeholder="Type office name" style="display:none;margin-top:6px;"/>
          </div>
          <div class="form-group">
            <label class="form-label">Item Borrowed *</label>
            <input type="text" name="item_borrowed" class="form-input" placeholder="e.g. Laptop, Extension cord"/>
          </div>
          <div class="form-group">
            <label class="form-label">Quantity *</label>
            <input type="number" name="quantity" class="form-input" min="1" value="1"/>
          </div>
          <div class="form-group">
            <label class="form-label">Date Borrowed *</label>
            <input type="date" name="date_borrowed" class="form-input" id="borrowDateInput"/>
          </div>
          <div class="form-group">
            <label class="form-label">Released By *</label>
            <select name="released_by_select" class="form-input" id="borrowReleasedBySelect" onchange="toggleOjtInput(this,'borrowReleasedByOjt')">
              <option value="">Select employee...</option>
            </select>
            <input type="text" name="released_by_ojt" class="form-input" id="borrowReleasedByOjt" placeholder="Enter OJT trainee name" style="display:none;margin-top:6px;"/>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-ghost" onclick="closeModal('newBorrowModal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Entry</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- PROCESS RETURN -->
<div class="modal-overlay hidden" id="returnModal">
  <div class="modal-box">
    <div class="modal-header">
      <span class="modal-title">Process Return</span>
      <button class="modal-close" onclick="closeModal('returnModal')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div id="returnAlert"></div>
      <input type="hidden" id="returnBorrowId"/>
      <div class="form-grid">
        <div class="form-group span-2">
          <label class="form-label">Returned By *</label>
          <input type="text" id="returnedBy" class="form-input" placeholder="Borrower's name"/>
        </div>
        <div class="form-group">
          <label class="form-label">Return Date</label>
          <input type="date" id="returnDate" class="form-input"/>
        </div>
        <div class="form-group">
          <label class="form-label">Received By *</label>
          <select id="returnReceivedBySelect" class="form-input" onchange="toggleOjtInput(this,'returnReceivedByOjt')">
            <option value="">Select employee...</option>
          </select>
          <input type="text" id="returnReceivedByOjt" class="form-input" placeholder="OJT trainee name" style="display:none;margin-top:6px;"/>
        </div>
        <div class="form-group span-2">
          <label class="form-label">Comments</label>
          <textarea id="returnComments" class="form-input" placeholder="Optional notes..."></textarea>
        </div>
      </div>
      <div class="form-actions">
        <button class="btn btn-ghost" onclick="closeModal('returnModal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitReturn()">Confirm Return</button>
      </div>
    </div>
  </div>
</div>

<!-- REPAIR DETAIL VIEW -->
<div class="modal-overlay hidden" id="repairDetailModal">
  <div class="modal-box" style="max-width:620px;">
    <div class="modal-header">
      <div>
        <span class="modal-title" id="rdm-title">Repair Record</span>
        <div style="margin-top:5px;" id="rdm-badge"></div>
      </div>
      <button class="modal-close" onclick="closeModal('repairDetailModal')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="modal-body" id="rdm-body"></div>
  </div>
</div>

<!-- RETURN DETAIL VIEW -->
<div class="modal-overlay hidden" id="returnDetailModal">
  <div class="modal-box" style="max-width:620px;">
    <div class="modal-header">
      <div>
        <span class="modal-title" id="bdm-title">Borrow / Return Record</span>
        <div style="margin-top:5px;" id="bdm-badge"></div>
      </div>
      <button class="modal-close" onclick="closeModal('returnDetailModal')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="modal-body" id="bdm-body"></div>
  </div>
</div>

<style>
/* ── Detail view layout ── */
.detail-section {
  margin-bottom: 20px;
}
.detail-section:last-child { margin-bottom: 0; }
.detail-section-title {
  font-size: 0.62rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--muted);
  margin-bottom: 10px;
  padding-bottom: 6px;
  border-bottom: 1px solid var(--border);
}
.detail-grid-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.detail-field { display: flex; flex-direction: column; gap: 3px; }
.detail-label {
  font-size: 0.65rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--muted);
}
.detail-value {
  font-size: 0.85rem;
  color: var(--text);
  font-weight: 500;
  word-break: break-word;
}
.detail-value.mono { font-family: 'DM Mono', monospace; font-size: 0.78rem; color: var(--text2); }
.detail-value.long {
  font-size: 0.82rem;
  line-height: 1.5;
  color: var(--text2);
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 8px 10px;
  margin-top: 2px;
}
.detail-span-2 { grid-column: span 2; }
.detail-divider {
  height: 1px;
  background: var(--border);
  margin: 16px 0;
}
</style>

<!-- ══════ SCRIPTS ══════ -->
<script src="js/config.js"></script>
<script src="js/api.js"></script>
<script src="js/utils.js"></script>
<script src="js/dropdowns.js"></script>
<script src="js/navigation.js"></script>
<script src="js/dashboard-tab.js"></script>
<script src="js/repairs.js"></script>
<script src="js/borrows.js"></script>
<script>
  // ─── Auth Guard ───────────────────────────────────────────────────────────
  if (!localStorage.getItem('token')) window.location.href = 'index.html';

  const username = localStorage.getItem('username') || 'Admin';
  document.getElementById('sidebarUsername').textContent = username;
  document.getElementById('userInitial').textContent = username.charAt(0).toUpperCase();

  function logout() {
    localStorage.removeItem('token');
    localStorage.removeItem('username');
    window.location.href = 'index.html';
  }

  // ─── Init ─────────────────────────────────────────────────────────────────
  document.getElementById('repairDateInput').value = today();
  document.getElementById('borrowDateInput').value = today();

  // Load dropdowns then render the default tab (dashboard)
  loadLookups().then(() => loadDashboard());
</script>
</body>
</html>
