<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ITSS Office Dashboard</title>
  <link rel="icon" type="image/jpeg" href="assets/logo.jpg"/>
  <link rel="stylesheet" href="css/main.css"/>
  <style>
    .detail-section { margin-bottom: 20px; }
    .detail-section:last-child { margin-bottom: 0; }
    .detail-section-title { font-size:.62rem; font-weight:700; text-transform:uppercase; letter-spacing:.12em; color:var(--muted); margin-bottom:10px; padding-bottom:6px; border-bottom:1px solid var(--border); }
    .detail-grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .detail-field { display:flex; flex-direction:column; gap:3px; }
    .detail-label { font-size:.65rem; font-weight:600; text-transform:uppercase; letter-spacing:.08em; color:var(--muted); }
    .detail-value { font-size:.85rem; color:var(--text); font-weight:500; word-break:break-word; }
    .detail-value.mono { font-family:'DM Mono',monospace; font-size:.78rem; color:var(--text2); }
    .detail-value.long { font-size:.82rem; line-height:1.5; color:var(--text2); background:var(--bg2); border:1px solid var(--border); border-radius:var(--radius-sm); padding:8px 10px; margin-top:2px; }
    .detail-span-2 { grid-column:span 2; }
  </style>
</head>
<body>

<div class="sidebar-backdrop" id="sidebarBackdrop" onclick="closeSidebar()"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<aside class="sidebar" id="sidebar">

  <!-- Mobile close button -->
  <button class="sidebar-close-btn" onclick="closeSidebar()">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
  </button>

  <div class="sidebar-logo">
    <div style="display:flex;align-items:center;gap:11px;">
      <div class="logo-badge" style="background:none;box-shadow:none;padding:0;overflow:hidden;flex-shrink:0;">
        <img src="assets/logo.jpg" alt="ITSS Office Logo" style="width:36px;height:36px;object-fit:cover;border-radius:9px;display:block;"/>
      </div>
      <div class="logo-text-wrap">
        <div class="logo-title">ITSS Office</div>
        <div class="logo-sub">LOGS SYSTEM</div>
      </div>
    </div>
  </div>

  <div class="nav-section">
    <div class="nav-label">Overview</div>
    <div class="nav-item active" data-tab="dashboard" data-tooltip="Dashboard" onclick="switchTab('dashboard')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink:0;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h4a1 1 0 011 1v5a1 1 0 01-1 1H5a1 1 0 01-1-1V5zm10 0a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 15a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1v-4zm10-3a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1v-7z"/></svg>
      <span class="nav-item-text">Dashboard</span>
    </div>
  </div>

  <div class="nav-section">
    <div class="nav-label">Modules</div>
    <div class="nav-item" data-tab="repairLogs" data-tooltip="Repair Logs" onclick="switchTab('repairLogs')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink:0;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
      <span class="nav-item-text">Repair Logs</span>
    </div>
    <div class="nav-item" data-tab="borrowLogs" data-tooltip="Borrow Logs" onclick="switchTab('borrowLogs')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink:0;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
      <span class="nav-item-text">Borrow Logs</span>
    </div>
    <div class="nav-item" data-tab="reservationLogs" data-tooltip="Reservations" onclick="switchTab('reservationLogs')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink:0;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
      <span class="nav-item-text">Reservations</span>
    </div>
    <div class="nav-item" data-tab="tech4ed" data-tooltip="Tech4Ed Sessions" onclick="switchTab('tech4ed')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink:0;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
      <span class="nav-item-text">Tech4Ed Sessions</span>
    </div>
  </div>

  <div class="sidebar-footer">
    <div class="sidebar-footer-content">
      <div class="user-badge" id="userInitial">A</div>
      <div class="sidebar-footer-text">
        <div style="font-size:.78rem;font-weight:600;color:white;" id="sidebarUsername">Admin</div>
        <div style="font-size:.62rem;color:rgba(255,255,255,0.4);display:flex;align-items:center;gap:5px;"><span class="pulse-dot"></span> Online</div>
      </div>
    </div>
    <button class="btn-logout" onclick="logout()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink:0;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
      <span class="btn-logout-text">Sign Out</span>
    </button>
    <!-- Collapse button (desktop only) -->
    <button class="sidebar-collapse-btn" id="sidebarCollapseBtn" onclick="toggleSidebarCollapse()" title="Toggle sidebar">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      <span class="sidebar-collapse-btn-text">Collapse sidebar</span>
    </button>
  </div>
</aside>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<main class="main" id="mainContent">
  <!-- Mobile Top Bar -->
  <div class="mobile-topbar">
    <button class="mobile-menu-btn" onclick="openSidebar()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
    </button>
    <span style="font-weight:700;font-size:.92rem;" id="mobileTitleBar">Dashboard</span>

    <!-- Theme toggle in mobile topbar -->
    <button class="theme-toggle" onclick="toggleTheme()" id="mobileThemeToggle" aria-label="Toggle theme">
      <div class="theme-toggle-track">
        <div class="theme-toggle-thumb">
          <svg id="mobileThemeIcon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"/>
          </svg>
        </div>
      </div>
      <span id="mobileThemeLabel" style="color:var(--text2);">Dark</span>
    </button>
  </div>

  <div class="main-inner">
    <!-- Desktop Page Header -->
    <div class="page-header desktop-header">
      <div class="page-header-left">
        <div class="page-title" id="pageTitle">Dashboard</div>
        <div class="page-sub"   id="pageSubtitle">Overview of all ITSS office activities</div>
      </div>
      <!-- Theme Toggle (desktop) -->
      <button class="theme-toggle" onclick="toggleTheme()" id="desktopThemeToggle" aria-label="Toggle theme">
        <div class="theme-toggle-track">
          <div class="theme-toggle-thumb">
            <svg id="desktopThemeIcon" fill="currentColor" viewBox="0 0 24 24">
              <path d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"/>
            </svg>
          </div>
        </div>
        <span id="desktopThemeLabel">Dark Mode</span>
      </button>
    </div>

    <!-- ‚ïê‚ïê TAB: DASHBOARD ‚ïê‚ïê -->
    <div id="tab-dashboard" class="tab-content active">
      <div class="stats-grid">
        <div class="stat-card blue">
          <div class="stat-icon" style="background:rgba(59,130,246,0.12);color:#60a5fa;">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
          </div>
          <div class="stat-label">Total Repairs</div>
          <div class="stat-value" style="color:#60a5fa;" id="ds-total-repairs">‚Äî</div>
          <div class="stat-change">All time</div>
        </div>
        <div class="stat-card amber">
          <div class="stat-icon" style="background:rgba(245,158,11,0.12);color:#fbbf24;">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div>
          <div class="stat-label">Pending Repairs</div>
          <div class="stat-value" style="color:#fbbf24;" id="ds-pending-repairs">‚Äî</div>
          <div class="stat-change">Awaiting service</div>
        </div>
        <div class="stat-card green">
          <div class="stat-icon" style="background:rgba(16,185,129,0.12);color:#34d399;">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
          </div>
          <div class="stat-label">Total Borrowed</div>
          <div class="stat-value" style="color:#34d399;" id="ds-total-borrowed">‚Äî</div>
          <div class="stat-change">All time</div>
        </div>
        <div class="stat-card purple">
          <div class="stat-icon" style="background:rgba(168,85,247,0.12);color:#c084fc;">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/></svg>
          </div>
          <div class="stat-label">Pending Returns</div>
          <div class="stat-value" style="color:#c084fc;" id="ds-pending-borrows">‚Äî</div>
          <div class="stat-change">Awaiting return</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:16px;">
        <div class="stat-card green"  style="padding:14px 18px;"><div class="stat-label">Items Released</div><div class="stat-value" style="color:#34d399;font-size:1.5rem;" id="ds-released">‚Äî</div></div>
        <div class="stat-card blue"   style="padding:14px 18px;"><div class="stat-label">Items Returned</div><div class="stat-value" style="color:#60a5fa;font-size:1.5rem;" id="ds-returned">‚Äî</div></div>
        <div class="stat-card"        style="padding:14px 18px;"><div class="stat-label">Active Reservations</div><div class="stat-value" style="color:#34d399;font-size:1.5rem;" id="ds-reservations">‚Äî</div></div>
        <div class="stat-card"        style="padding:14px 18px;"><div class="stat-label">Tech4Ed Today</div><div class="stat-value" style="color:#818cf8;font-size:1.5rem;" id="ds-tech4ed">‚Äî</div></div>
      </div>

      <div class="dashboard-grid">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Recent Activity</span>
            <div style="display:flex;align-items:center;gap:6px;"><span class="pulse-dot"></span><span style="font-size:.68rem;color:var(--muted);">Live</span></div>
          </div>
          <ul class="activity-feed" id="activity-feed">
            <li style="padding:40px;text-align:center;color:var(--muted);font-size:.8rem;">Loading...</li>
          </ul>
        </div>
        <div>
          <div class="card" style="margin-bottom:16px;">
            <div class="card-header"><span class="card-title">Repair Status</span></div>
            <div class="ring-container">
              <div class="donut-chart">
                <svg viewBox="0 0 120 120" width="120" height="120">
                  <circle cx="60" cy="60" r="45" fill="none" stroke="var(--border)" stroke-width="10"/>
                  <g id="donut-svg"></g>
                </svg>
                <div class="donut-center">
                  <div class="donut-center-value" id="donut-total">0</div>
                  <div class="donut-center-label">Total</div>
                </div>
              </div>
              <ul class="legend" id="donut-legend"></ul>
            </div>
          </div>
          <div class="card">
            <div class="card-header"><span class="card-title">By Office</span><span class="card-sub">All requests</span></div>
            <div class="bar-chart" id="office-bars"><div style="text-align:center;color:var(--muted);font-size:.8rem;padding:20px;">Loading...</div></div>
          </div>
        </div>
      </div>

      <div class="charts-grid" style="margin-top:16px;">
        <div class="card">
          <div class="card-header"><span class="card-title">Monthly Trend</span><span class="card-sub">Last 6 months</span></div>
          <div class="chart-canvas-wrap">
            <canvas id="monthlyTrendCanvas"></canvas>
            <div class="canvas-legend"></div>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><span class="card-title">Repair Outcome</span><span class="card-sub">By result type</span></div>
          <div class="bar-chart" id="repair-type-bars"><div style="text-align:center;color:var(--muted);font-size:.8rem;padding:20px;">Loading...</div></div>
        </div>
      </div>

      <div class="charts-grid" style="margin-top:16px;">
        <div class="card">
          <div class="card-header"><span class="card-title">Borrow Status</span><span class="card-sub">Pending vs Returned</span></div>
          <div class="chart-canvas-wrap" style="display:flex;flex-direction:column;align-items:center;padding:20px;">
            <canvas id="borrowStatusCanvas" style="max-width:180px;max-height:180px;"></canvas>
            <div class="canvas-legend" style="margin-top:10px;text-align:center;"></div>
          </div>
        </div>
      </div>
    </div>


    <!-- ‚ïê‚ïê TAB: REPAIR LOGS ‚ïê‚ïê -->
    <div id="tab-repairLogs" class="tab-content">
      <div class="stats-grid">
        <div class="stat-card amber"><div class="stat-label">Pending</div><div class="stat-value" style="color:var(--warn)"    id="stat-pending">‚Äî</div></div>
        <div class="stat-card green"><div class="stat-label">Fixed</div><div class="stat-value" style="color:var(--success)"  id="stat-fixed">‚Äî</div></div>
        <div class="stat-card red">  <div class="stat-label">Unserviceable</div><div class="stat-value" style="color:var(--danger)"  id="stat-unserviceable">‚Äî</div></div>
        <div class="stat-card">      <div class="stat-label">Released</div><div class="stat-value" style="color:var(--info)"   id="stat-released">‚Äî</div></div>
      </div>

      <div class="subtab-bar">
        <button class="subtab-btn active" data-subtab="pending" onclick="switchRepairSubTab('pending')">üîß Pending</button>
        <button class="subtab-btn" data-subtab="ready"   onclick="switchRepairSubTab('ready')">‚úÖ Ready for Release</button>
        <button class="subtab-btn" data-subtab="history" onclick="switchRepairSubTab('history')">üìã History</button>
      </div>

      <div id="repair-subtab-pending" class="subtab-content active">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Pending for Repair</span>
            <button class="btn btn-primary btn-sm" onclick="openModal('newRepairModal')">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>New Repair
            </button>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>#</th><th>Customer</th><th>Office</th><th>Item</th><th>Specs</th><th>Qty</th><th>Problem</th><th>Received By</th><th>Date</th><th>Status</th><th>Action</th></tr></thead>
              <tbody id="pendingRepairsBody"><tr><td colspan="11"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
            </table>
          </div>
          <div id="repairPendingPagination"></div>
        </div>
      </div>

      <div id="repair-subtab-ready" class="subtab-content">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Ready for Release</span>
            <span style="font-size:.72rem;color:var(--muted);">Fixed &amp; Unserviceable items</span>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>#</th><th>Customer</th><th>Office</th><th>Item</th><th>Repaired By</th><th>Comment</th><th>Condition</th><th>Action</th></tr></thead>
              <tbody id="releaseBody"><tr><td colspan="8"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
            </table>
          </div>
          <div id="repairReadyPagination"></div>
        </div>
      </div>

      <div id="repair-subtab-history" class="subtab-content">
        <div class="card">
          <div class="card-header"><span class="card-title">Released Repairs</span><span class="badge badge-released">Released</span></div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>#</th><th>Customer</th><th>Office</th><th>Item</th><th>Specs</th><th>Problem</th><th>Repaired By</th><th>Claimed By</th><th>Released By</th><th>Date Released</th><th>Status</th><th>Action</th></tr></thead>
              <tbody id="repairHistoryBody"><tr><td colspan="12"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
            </table>
          </div>
          <div id="repairHistoryPagination"></div>
        </div>
      </div>
    </div>


    <!-- ‚ïê‚ïê TAB: BORROW LOGS ‚ïê‚ïê -->
    <div id="tab-borrowLogs" class="tab-content">
      <div class="stats-grid stats-grid-2" style="max-width:400px;margin-bottom:16px;">
        <div class="stat-card amber"><div class="stat-label">Pending Returns</div><div class="stat-value" style="color:var(--warn)"    id="stat-borrow-pending">‚Äî</div></div>
        <div class="stat-card green"><div class="stat-label">Returned</div><div class="stat-value" style="color:var(--success)" id="stat-borrow-returned">‚Äî</div></div>
      </div>

      <div class="subtab-bar">
        <button class="subtab-btn active" data-subtab="pending" onclick="switchBorrowSubTab('pending')">üì¶ Pending</button>
        <button class="subtab-btn" data-subtab="history" onclick="switchBorrowSubTab('history')">‚Ü©Ô∏è Returned History</button>
      </div>

      <div id="borrow-subtab-pending" class="subtab-content active">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Pending Borrowed Items</span>
            <button class="btn btn-primary btn-sm" onclick="openModal('newBorrowModal')">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>New Borrow
            </button>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>#</th><th>Borrower</th><th>Office</th><th>Item</th><th>Qty</th><th>Released By</th><th>Date Borrowed</th><th>Status</th><th>Action</th></tr></thead>
              <tbody id="pendingBorrowBody"><tr><td colspan="9"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
            </table>
          </div>
          <div id="borrowPendingPagination"></div>
        </div>
      </div>

      <div id="borrow-subtab-history" class="subtab-content">
        <div class="card">
          <div class="card-header"><span class="card-title">Returned Items History</span><span class="badge badge-returned">Returned</span></div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>#</th><th>Borrower</th><th>Office</th><th>Item</th><th>Qty</th><th>Returned By</th><th>Received By</th><th>Return Date</th><th>Comments</th><th>Status</th><th>Action</th></tr></thead>
              <tbody id="returnHistoryBody"><tr><td colspan="11"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
            </table>
          </div>
          <div id="borrowHistoryPagination"></div>
        </div>
      </div>
    </div>


    <!-- ‚ïê‚ïê TAB: RESERVATIONS ‚ïê‚ïê -->
    <div id="tab-reservationLogs" class="tab-content">
      <div class="stats-grid" style="grid-template-columns:repeat(4,1fr);margin-bottom:16px;">
        <div class="stat-card green"><div class="stat-label">Active</div><div class="stat-value" style="color:var(--success)"  id="stat-res-active">‚Äî</div></div>
        <div class="stat-card red">  <div class="stat-label">Overdue</div><div class="stat-value" style="color:var(--danger)"  id="stat-res-overdue">‚Äî</div></div>
        <div class="stat-card blue"> <div class="stat-label">Returned</div><div class="stat-value" style="color:#60a5fa"       id="stat-res-returned">‚Äî</div></div>
        <div class="stat-card">      <div class="stat-label">Total</div><div class="stat-value" style="color:var(--text)"      id="stat-res-total">‚Äî</div></div>
      </div>

      <div class="subtab-bar">
        <button class="subtab-btn active" data-subtab="active"  onclick="switchResSubTab('active')">üìÖ Active</button>
        <button class="subtab-btn" data-subtab="history" onclick="switchResSubTab('history')">üìã History</button>
      </div>

      <div id="res-subtab-active" class="subtab-content active">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Active Reservations</span>
            <button class="btn btn-primary btn-sm" onclick="openModal('newReservationModal')">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>New Reservation
            </button>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>#</th><th>Borrower</th><th>Office</th><th>Item</th><th>Qty</th><th>Reserved</th><th>Expected Return</th><th>Released By</th><th>Status</th><th>Action</th></tr></thead>
              <tbody id="pendingReservationBody"><tr><td colspan="10"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
            </table>
          </div>
          <div id="resPendingPagination"></div>
        </div>
      </div>

      <div id="res-subtab-history" class="subtab-content">
        <div class="card">
          <div class="card-header"><span class="card-title">Reservation History</span><span class="badge badge-returned">Returned</span></div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>#</th><th>Borrower</th><th>Office</th><th>Item</th><th>Qty</th><th>Reserved</th><th>Expected Return</th><th>Returned By</th><th>Received By</th><th>Actual Return</th><th>Status</th><th>Action</th></tr></thead>
              <tbody id="reservationHistoryBody"><tr><td colspan="12"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
            </table>
          </div>
          <div id="resHistoryPagination"></div>
        </div>
      </div>
    </div>


    <!-- ‚ïê‚ïê TAB: TECH4ED ‚ïê‚ïê -->
    <div id="tab-tech4ed" class="tab-content">
      <div class="stats-grid stats-grid-3" style="max-width:600px;margin-bottom:16px;">
        <div class="stat-card green">
          <div class="stat-label">Active Sessions</div>
          <div class="stat-value" style="color:var(--success)" id="stat-t4e-active">‚Äî</div>
          <div class="stat-change" style="display:flex;align-items:center;gap:5px;"><span class="pulse-dot"></span> Live</div>
        </div>
        <div class="stat-card blue">
          <div class="stat-label">Total Entries</div>
          <div class="stat-value" style="color:#60a5fa" id="stat-t4e-entries">‚Äî</div>
          <div class="stat-change">Entry log</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">All Records</div>
          <div class="stat-value" style="color:var(--text)" id="stat-t4e-total">‚Äî</div>
          <div class="stat-change">Combined</div>
        </div>
      </div>

      <div class="subtab-bar">
        <button class="subtab-btn active" data-subtab="entries" onclick="switchTech4EdSubTab('entries')">üìã Entries Log</button>
        <button class="subtab-btn" data-subtab="active"   onclick="switchTech4EdSubTab('active')">‚è± Active Sessions</button>
        <button class="subtab-btn" data-subtab="history"  onclick="switchTech4EdSubTab('history')">‚úÖ Session History</button>
      </div>

      <div id="t4e-subtab-entries" class="subtab-content active">
        <div class="card">
          <div class="card-header">
            <div>
              <span class="card-title">Entries Log</span>
              <div style="font-size:.7rem;color:var(--muted);margin-top:2px;">Simple visitor log ‚Äî no time tracking</div>
            </div>
            <button class="btn btn-primary btn-sm" onclick="openModal('newEntryLogModal')">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>New Entry
            </button>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>#</th><th>Name</th><th>Gender</th><th>Purpose</th></tr></thead>
              <tbody id="entriesLogBody"><tr><td colspan="4"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
            </table>
          </div>
          <div id="t4eEntriesPagination"></div>
        </div>
      </div>

      <div id="t4e-subtab-active" class="subtab-content">
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:8px;">
              <span class="card-title">Active Sessions</span>
              <span class="session-live"><span class="pulse-dot"></span> Live</span>
            </div>
            <button class="btn btn-primary btn-sm" onclick="openModal('newTimeInModal')">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>Time In
            </button>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>#</th><th>Name</th><th>Gender</th><th>Purpose</th><th>Time In</th><th>Elapsed</th><th>Action</th></tr></thead>
              <tbody id="activeTech4EdBody"><tr><td colspan="7"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="t4e-subtab-history" class="subtab-content">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Session History</span>
            <span style="font-size:.72rem;color:var(--muted);">Completed time-in sessions</span>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>#</th><th>Name</th><th>Gender</th><th>Purpose</th><th>Time In</th><th>Time Out</th><th>Duration</th></tr></thead>
              <tbody id="tech4EdHistoryBody"><tr><td colspan="7"><div class="empty-state"><p>Loading...</p></div></td></tr></tbody>
            </table>
          </div>
          <div id="t4eHistoryPagination"></div>
        </div>
      </div>
    </div>
  </div>
</main>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- NEW REPAIR -->
<div class="modal-overlay hidden" id="newRepairModal">
  <div class="modal-box">
    <div class="modal-header">
      <span class="modal-title">New Repair Entry</span>
      <button class="modal-close" onclick="closeModal('newRepairModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
    </div>
    <div class="modal-body">
      <div id="newRepairAlert"></div>
      <form id="newRepairForm">
        <div class="form-grid">
          <div class="form-group"><label class="form-label">Customer Name *</label><input type="text" name="customer_name" class="form-input" placeholder="Full name"/></div>
          <div class="form-group"><label class="form-label">Contact Number</label><input type="tel" name="contact_number" class="form-input" placeholder="e.g. 09171234567"/></div>
          <div class="form-group"><label class="form-label">Office *</label><select name="office_select" class="form-input" id="repairOfficeSelect" onchange="toggleOtherInput(this,'repairOfficeOther')"><option value="">Select office...</option></select><input type="text" name="office_other" class="form-input" id="repairOfficeOther" placeholder="Type office name" style="display:none;margin-top:6px;"/></div>
          <div class="form-group"><label class="form-label">Item Name *</label><input type="text" name="item_name" class="form-input" placeholder="e.g. Printer, Laptop"/></div>
          <div class="form-group"><label class="form-label">Model / Specs</label><input type="text" name="serial_specs" class="form-input" placeholder="e.g. L3210, Core i5 8GB"/></div>
          <div class="form-group"><label class="form-label">Quantity *</label><input type="number" name="quantity" class="form-input" min="1" max="9999" value="1"/></div>
          <div class="form-group"><label class="form-label">Date Received *</label><input type="date" name="date_received" class="form-input" id="repairDateInput"/></div>
          <div class="form-group span-2"><label class="form-label">Received By *</label><select name="received_by_select" class="form-input" id="repairReceivedBySelect" onchange="toggleOjtInput(this,'repairReceivedByOjt')"><option value="">Select employee...</option></select><input type="text" name="received_by_ojt" class="form-input" id="repairReceivedByOjt" placeholder="Enter OJT trainee name" style="display:none;margin-top:6px;"/></div>
          <div class="form-group span-2"><label class="form-label">Problem Description *</label><textarea name="problem_description" class="form-input" placeholder="Describe the issue in detail..."></textarea></div>
        </div>
        <div class="form-actions"><button type="button" class="btn btn-ghost" onclick="closeModal('newRepairModal')">Cancel</button><button type="submit" class="btn btn-primary">Save Entry</button></div>
      </form>
    </div>
  </div>
</div>

<!-- UPDATE REPAIR STATUS -->
<div class="modal-overlay hidden" id="updateStatusModal">
  <div class="modal-box">
    <div class="modal-header"><span class="modal-title">Update Repair Status</span><button class="modal-close" onclick="closeModal('updateStatusModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div>
    <div class="modal-body">
      <div id="updateStatusAlert"></div>
      <input type="hidden" id="updateRepairId"/>
      <div class="form-grid">
        <div class="form-group"><label class="form-label">Status *</label><select id="updateStatus" class="form-input"><option value="Fixed">Fixed</option><option value="Unserviceable">Unserviceable</option></select></div>
        <div class="form-group"><label class="form-label">Repaired By *</label><select id="updateRepairedBySelect" class="form-input" onchange="toggleOjtInput(this,'updateRepairedByOjt')"><option value="">Select employee...</option></select><input type="text" id="updateRepairedByOjt" class="form-input" placeholder="OJT trainee name" style="display:none;margin-top:6px;"/></div>
        <div class="form-group span-2"><label class="form-label">Comment</label><textarea id="repairComment" class="form-input" placeholder="Optional notes..."></textarea></div>
      </div>
      <div class="form-actions"><button class="btn btn-ghost" onclick="closeModal('updateStatusModal')">Cancel</button><button class="btn btn-primary" onclick="submitUpdateStatus()">Update Status</button></div>
    </div>
  </div>
</div>

<!-- RELEASE REPAIR -->
<div class="modal-overlay hidden" id="releaseModal">
  <div class="modal-box">
    <div class="modal-header"><span class="modal-title">Release Item</span><button class="modal-close" onclick="closeModal('releaseModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div>
    <div class="modal-body">
      <div id="releaseAlert"></div>
      <input type="hidden" id="releaseRepairId"/>
      <div class="form-grid">
        <div class="form-group span-2"><label class="form-label">Claimed By *</label><input type="text" id="claimedBy" class="form-input" placeholder="Name of person claiming"/></div>
        <div class="form-group"><label class="form-label">Date Claimed</label><input type="date" id="dateClaimed" class="form-input"/></div>
        <div class="form-group"><label class="form-label">Released By *</label><select id="releaseReleasedBySelect" class="form-input" onchange="toggleOjtInput(this,'releaseReleasedByOjt')"><option value="">Select employee...</option></select><input type="text" id="releaseReleasedByOjt" class="form-input" placeholder="OJT trainee name" style="display:none;margin-top:6px;"/></div>
      </div>
      <div class="form-actions"><button class="btn btn-ghost" onclick="closeModal('releaseModal')">Cancel</button><button class="btn btn-primary" onclick="submitRelease()">Confirm Release</button></div>
    </div>
  </div>
</div>

<!-- NEW BORROW -->
<div class="modal-overlay hidden" id="newBorrowModal">
  <div class="modal-box">
    <div class="modal-header"><span class="modal-title">New Borrow Entry</span><button class="modal-close" onclick="closeModal('newBorrowModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div>
    <div class="modal-body">
      <div id="newBorrowAlert"></div>
      <form id="newBorrowForm">
        <div class="form-grid">
          <div class="form-group"><label class="form-label">Borrower Name *</label><input type="text" name="borrower_name" class="form-input" placeholder="Full name"/></div>
          <div class="form-group"><label class="form-label">Contact Number</label><input type="tel" name="contact_number" class="form-input" placeholder="e.g. 09171234567"/></div>
          <div class="form-group"><label class="form-label">Office *</label><select name="office_select" class="form-input" id="borrowOfficeSelect" onchange="toggleOtherInput(this,'borrowOfficeOther')"><option value="">Select office...</option></select><input type="text" name="office_other" class="form-input" id="borrowOfficeOther" placeholder="Type office name" style="display:none;margin-top:6px;"/></div>
          <div class="form-group"><label class="form-label">Item Borrowed *</label><input type="text" name="item_borrowed" class="form-input" placeholder="e.g. Laptop, Extension cord"/></div>
          <div class="form-group"><label class="form-label">Quantity *</label><input type="number" name="quantity" class="form-input" min="1" max="9999" value="1"/></div>
          <div class="form-group"><label class="form-label">Date Borrowed *</label><input type="date" name="date_borrowed" class="form-input" id="borrowDateInput"/></div>
          <div class="form-group"><label class="form-label">Released By *</label><select name="released_by_select" class="form-input" id="borrowReleasedBySelect" onchange="toggleOjtInput(this,'borrowReleasedByOjt')"><option value="">Select employee...</option></select><input type="text" name="released_by_ojt" class="form-input" id="borrowReleasedByOjt" placeholder="Enter OJT trainee name" style="display:none;margin-top:6px;"/></div>
        </div>
        <div class="form-actions"><button type="button" class="btn btn-ghost" onclick="closeModal('newBorrowModal')">Cancel</button><button type="submit" class="btn btn-primary">Save Entry</button></div>
      </form>
    </div>
  </div>
</div>

<!-- PROCESS RETURN (borrow) -->
<div class="modal-overlay hidden" id="returnModal">
  <div class="modal-box">
    <div class="modal-header"><span class="modal-title">Process Return</span><button class="modal-close" onclick="closeModal('returnModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div>
    <div class="modal-body">
      <div id="returnAlert"></div>
      <input type="hidden" id="returnBorrowId"/>
      <div class="form-grid">
        <div class="form-group span-2"><label class="form-label">Returned By *</label><input type="text" id="returnedBy" class="form-input" placeholder="Borrower's name"/></div>
        <div class="form-group"><label class="form-label">Return Date</label><input type="date" id="returnDate" class="form-input"/></div>
        <div class="form-group"><label class="form-label">Received By *</label><select id="returnReceivedBySelect" class="form-input" onchange="toggleOjtInput(this,'returnReceivedByOjt')"><option value="">Select employee...</option></select><input type="text" id="returnReceivedByOjt" class="form-input" placeholder="OJT trainee name" style="display:none;margin-top:6px;"/></div>
        <div class="form-group span-2"><label class="form-label">Comments</label><textarea id="returnComments" class="form-input" placeholder="Optional notes..."></textarea></div>
      </div>
      <div class="form-actions"><button class="btn btn-ghost" onclick="closeModal('returnModal')">Cancel</button><button class="btn btn-primary" onclick="submitReturn()">Confirm Return</button></div>
    </div>
  </div>
</div>

<!-- NEW RESERVATION -->
<div class="modal-overlay hidden" id="newReservationModal">
  <div class="modal-box">
    <div class="modal-header">
      <span class="modal-title">New Reservation</span>
      <button class="modal-close" onclick="closeModal('newReservationModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
    </div>
    <div class="modal-body">
      <div id="newReservationAlert"></div>
      <form id="newReservationForm">
        <div class="form-grid">
          <div class="form-group"><label class="form-label">Borrower Name *</label><input type="text" name="borrower_name" class="form-input" placeholder="Full name"/></div>
          <div class="form-group"><label class="form-label">Contact Number</label><input type="tel" name="contact_number" class="form-input" placeholder="e.g. 09171234567"/></div>
          <div class="form-group"><label class="form-label">Office *</label><select name="office_select" class="form-input" id="resOfficeSelect" onchange="toggleOtherInput(this,'resOfficeOther')"><option value="">Select office...</option></select><input type="text" name="office_other" class="form-input" id="resOfficeOther" placeholder="Type office name" style="display:none;margin-top:6px;"/></div>
          <div class="form-group"><label class="form-label">Item Name *</label><input type="text" name="item_name" class="form-input" placeholder="e.g. Projector, Camera"/></div>
          <div class="form-group"><label class="form-label">Quantity *</label><input type="number" name="quantity" class="form-input" min="1" max="9999" value="1"/></div>
          <div class="form-group"><label class="form-label">Reservation Date *</label><input type="date" name="reservation_date" class="form-input" id="resDateInput"/></div>
          <div class="form-group"><label class="form-label">Expected Return Date *</label><input type="date" name="expected_return_date" class="form-input" id="resExpectedReturnInput"/></div>
          <div class="form-group"><label class="form-label">Released By *</label><select name="released_by_select" class="form-input" id="resReleasedBySelect" onchange="toggleOjtInput(this,'resReleasedByOjt')"><option value="">Select employee...</option></select><input type="text" name="released_by_ojt" class="form-input" id="resReleasedByOjt" placeholder="Enter OJT trainee name" style="display:none;margin-top:6px;"/></div>
        </div>
        <div style="background:rgba(59,130,246,0.06);border:1px solid rgba(59,130,246,0.15);border-radius:var(--radius-sm);padding:10px 12px;margin-top:4px;font-size:.75rem;color:var(--text2);display:flex;align-items:center;gap:8px;">
          <svg width="14" height="14" fill="none" stroke="#60a5fa" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          Item will be marked <strong style="color:var(--text);margin:0 3px;">Active</strong> immediately.
        </div>
        <div class="form-actions"><button type="button" class="btn btn-ghost" onclick="closeModal('newReservationModal')">Cancel</button><button type="submit" class="btn btn-primary">Save Reservation</button></div>
      </form>
    </div>
  </div>
</div>

<!-- RESERVATION RETURN -->
<div class="modal-overlay hidden" id="reservationReturnModal">
  <div class="modal-box">
    <div class="modal-header"><span class="modal-title">Process Reservation Return</span><button class="modal-close" onclick="closeModal('reservationReturnModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div>
    <div class="modal-body">
      <div id="resReturnAlert"></div>
      <input type="hidden" id="resReturnId"/>
      <div class="form-grid">
        <div class="form-group span-2"><label class="form-label">Returned By *</label><input type="text" id="resReturnedBy" class="form-input" placeholder="Borrower's name"/></div>
        <div class="form-group"><label class="form-label">Actual Return Date</label><input type="date" id="resActualReturnDate" class="form-input"/></div>
        <div class="form-group"><label class="form-label">Received By *</label><select id="resReturnReceivedBySelect" class="form-input" onchange="toggleOjtInput(this,'resReturnReceivedByOjt')"><option value="">Select employee...</option></select><input type="text" id="resReturnReceivedByOjt" class="form-input" placeholder="OJT trainee name" style="display:none;margin-top:6px;"/></div>
        <div class="form-group span-2"><label class="form-label">Comments</label><textarea id="resReturnComments" class="form-input" placeholder="Optional notes..."></textarea></div>
      </div>
      <div class="form-actions"><button class="btn btn-ghost" onclick="closeModal('reservationReturnModal')">Cancel</button><button class="btn btn-primary" onclick="submitReservationReturn()">Confirm Return</button></div>
    </div>
  </div>
</div>

<!-- RESERVATION DETAIL VIEW -->
<div class="modal-overlay hidden" id="reservationDetailModal">
  <div class="modal-box" style="max-width:620px;">
    <div class="modal-header">
      <div><span class="modal-title" id="rsdm-title">Reservation Record</span><div style="margin-top:5px;" id="rsdm-badge"></div></div>
      <button class="modal-close" onclick="closeModal('reservationDetailModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
    </div>
    <div class="modal-body" id="rsdm-body"></div>
  </div>
</div>

<!-- NEW ENTRY LOG (Tech4Ed) -->
<div class="modal-overlay hidden" id="newEntryLogModal">
  <div class="modal-box" style="max-width:440px;">
    <div class="modal-header">
      <div><span class="modal-title">üìã New Entry Log</span><div style="font-size:.68rem;color:var(--muted);margin-top:3px;">Simple visitor log ‚Äî no time tracking</div></div>
      <button class="modal-close" onclick="closeModal('newEntryLogModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
    </div>
    <div class="modal-body">
      <div id="newEntryLogAlert"></div>
      <form id="newEntryLogForm">
        <div class="form-grid">
          <div class="form-group span-2"><label class="form-label">Full Name *</label><input type="text" name="el_name" class="form-input" placeholder="Enter full name" autocomplete="off"/></div>
          <div class="form-group"><label class="form-label">Gender *</label><select name="el_gender" class="form-input"><option value="">Select...</option><option value="Male">Male</option><option value="Female">Female</option><option value="Other">Other</option></select></div>
          <div class="form-group"><label class="form-label">Purpose *</label><input type="text" name="el_purpose" class="form-input" placeholder="e.g. Research, Online class"/></div>
        </div>
        <div class="form-actions"><button type="button" class="btn btn-ghost" onclick="closeModal('newEntryLogModal')">Cancel</button><button type="submit" class="btn btn-primary">Save Entry</button></div>
      </form>
    </div>
  </div>
</div>

<!-- NEW TIME-IN SESSION (Tech4Ed) -->
<div class="modal-overlay hidden" id="newTimeInModal">
  <div class="modal-box" style="max-width:440px;">
    <div class="modal-header">
      <div><span class="modal-title">‚è± New Time-In Session</span><div style="font-size:.68rem;color:var(--muted);margin-top:3px;">Time in recorded as <strong style="color:var(--success);">now</strong></div></div>
      <button class="modal-close" onclick="closeModal('newTimeInModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
    </div>
    <div class="modal-body">
      <div id="newTimeInAlert"></div>
      <form id="newTimeInForm">
        <div class="form-grid">
          <div class="form-group span-2"><label class="form-label">Full Name *</label><input type="text" name="ti_name" class="form-input" placeholder="Enter full name" autocomplete="off"/></div>
          <div class="form-group"><label class="form-label">Gender *</label><select name="ti_gender" class="form-input"><option value="">Select...</option><option value="Male">Male</option><option value="Female">Female</option><option value="Other">Other</option></select></div>
          <div class="form-group"><label class="form-label">Purpose *</label><input type="text" name="ti_purpose" class="form-input" placeholder="e.g. Research, Online class"/></div>
        </div>
        <div style="background:rgba(16,185,129,0.06);border:1px solid rgba(16,185,129,0.15);border-radius:var(--radius-sm);padding:10px 12px;margin-top:4px;font-size:.75rem;color:var(--text2);display:flex;align-items:center;gap:8px;">
          <svg width="14" height="14" fill="none" stroke="#34d399" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          A live timer starts immediately. Use <strong style="color:var(--text);margin:0 3px;">Time Out</strong> button when done.
        </div>
        <div class="form-actions"><button type="button" class="btn btn-ghost" onclick="closeModal('newTimeInModal')">Cancel</button><button type="submit" class="btn btn-primary">Start Session</button></div>
      </form>
    </div>
  </div>
</div>

<!-- REPAIR DETAIL VIEW -->
<div class="modal-overlay hidden" id="repairDetailModal">
  <div class="modal-box" style="max-width:620px;">
    <div class="modal-header">
      <div><span class="modal-title" id="rdm-title">Repair Record</span><div style="margin-top:5px;" id="rdm-badge"></div></div>
      <button class="modal-close" onclick="closeModal('repairDetailModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
    </div>
    <div class="modal-body" id="rdm-body"></div>
  </div>
</div>

<!-- BORROW/RETURN DETAIL VIEW -->
<div class="modal-overlay hidden" id="returnDetailModal">
  <div class="modal-box" style="max-width:620px;">
    <div class="modal-header">
      <div><span class="modal-title" id="bdm-title">Borrow / Return Record</span><div style="margin-top:5px;" id="bdm-badge"></div></div>
      <button class="modal-close" onclick="closeModal('returnDetailModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
    </div>
    <div class="modal-body" id="bdm-body"></div>
  </div>
</div>

<!-- DELETE CONFIRMATION -->
<div class="modal-overlay hidden" id="deleteConfirmModal">
  <div class="modal-box" style="max-width:420px;">
    <div class="modal-header" style="border-bottom-color:rgba(239,68,68,0.2);">
      <div style="display:flex;align-items:center;gap:10px;">
        <div style="width:32px;height:32px;border-radius:8px;background:rgba(239,68,68,0.12);display:flex;align-items:center;justify-content:center;flex-shrink:0;"><svg width="16" height="16" fill="none" stroke="#f87171" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></div>
        <span class="modal-title" style="color:#f87171;">Delete Record</span>
      </div>
      <button class="modal-close" onclick="closeModal('deleteConfirmModal')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
    </div>
    <div class="modal-body">
      <div id="deleteConfirmAlert"></div>
      <div style="background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.15);border-radius:var(--radius-sm);padding:12px 14px;margin-bottom:18px;">
        <div style="font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:#f87171;margin-bottom:4px;">Record to be deleted</div>
        <div id="deleteRecordLabel" style="font-size:.85rem;color:var(--text);font-weight:500;"></div>
      </div>
      <p style="font-size:.8rem;color:var(--text2);margin-bottom:16px;line-height:1.5;">This action is <strong style="color:var(--text);">permanent</strong> and cannot be undone. Enter your admin password to confirm.</p>
      <div class="form-group"><label class="form-label">Admin Password *</label><input type="password" id="deleteAdminPassword" class="form-input" placeholder="Enter your password" onkeydown="if(event.key==='Enter') submitDelete()"/></div>
      <div class="form-actions" style="margin-top:16px;">
        <button class="btn btn-ghost" onclick="closeModal('deleteConfirmModal')">Cancel</button>
        <button class="btn btn-sm" style="background:rgba(239,68,68,0.15);color:#f87171;border:1px solid rgba(239,68,68,0.3);padding:8px 16px;font-size:.78rem;font-weight:600;" onclick="submitDelete()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width:13px;height:13px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
          Confirm Delete
        </button>
      </div>
    </div>
  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCRIPTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script src="js/config.js"></script>
<script src="js/api.js"></script>
<script src="js/utils.js"></script>
<script src="js/dropdowns.js"></script>
<script src="js/navigation.js"></script>
<script src="js/dashboard-tab.js"></script>
<script src="js/repairs.js"></script>
<script src="js/borrows.js"></script>
<script src="js/reservations.js"></script>
<script src="js/tech4ed.js"></script>

<script>
  // ‚îÄ‚îÄ Auth check ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if (!localStorage.getItem('token')) window.location.href = 'index.html';

  const username = localStorage.getItem('username') || 'Admin';
  document.getElementById('sidebarUsername').textContent = username;
  document.getElementById('userInitial').textContent = username.charAt(0).toUpperCase();

  function logout() {
    localStorage.removeItem('token');
    localStorage.removeItem('username');
    window.location.href = 'index.html';
  }

  // ‚îÄ‚îÄ Theme toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const THEME_KEY = 'itss_theme';

  const sunSVG = `<path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.166 17.834a.75.75 0 00-1.06 1.06l1.59 1.591a.75.75 0 001.061-1.06l-1.59-1.591zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.166 6.166a.75.75 0 001.06 1.06l1.591-1.59a.75.75 0 00-1.061-1.061L6.166 6.166z"/>`;
  const moonSVG = `<path d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"/>`;

  function applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem(THEME_KEY, theme);

    const isLight = theme === 'light';
    const iconSVG = isLight ? sunSVG : moonSVG;
    const label   = isLight ? 'Light Mode' : 'Dark Mode';
    const mLabel  = isLight ? 'Light' : 'Dark';

    // Update desktop toggle
    const dIcon = document.getElementById('desktopThemeIcon');
    const dLabel = document.getElementById('desktopThemeLabel');
    if (dIcon)  dIcon.innerHTML = iconSVG;
    if (dLabel) dLabel.textContent = label;

    // Update mobile toggle
    const mIcon = document.getElementById('mobileThemeIcon');
    const mLabelEl = document.getElementById('mobileThemeLabel');
    if (mIcon)    mIcon.innerHTML = iconSVG;
    if (mLabelEl) mLabelEl.textContent = mLabel;
  }

  function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme') || 'dark';
    applyTheme(current === 'dark' ? 'light' : 'dark');
  }

  // Load saved theme preference
  const savedTheme = localStorage.getItem(THEME_KEY) || 'dark';
  applyTheme(savedTheme);

  // ‚îÄ‚îÄ Sidebar collapse (desktop only) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const SIDEBAR_KEY = 'itss_sidebar_collapsed';

  function toggleSidebarCollapse() {
    const sidebar = document.getElementById('sidebar');
    const main    = document.getElementById('mainContent');
    const isCollapsed = sidebar.classList.toggle('collapsed');
    main.classList.toggle('sidebar-collapsed', isCollapsed);
    localStorage.setItem(SIDEBAR_KEY, isCollapsed ? '1' : '0');
  }

  // Restore sidebar state
  if (window.innerWidth > 768) {
    const wasCollapsed = localStorage.getItem(SIDEBAR_KEY) === '1';
    if (wasCollapsed) {
      document.getElementById('sidebar').classList.add('collapsed');
      document.getElementById('mainContent').classList.add('sidebar-collapsed');
    }
  }

  // ‚îÄ‚îÄ Date defaults ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('repairDateInput').value        = today();
  document.getElementById('borrowDateInput').value         = today();
  document.getElementById('resDateInput').value            = today();
  document.getElementById('resExpectedReturnInput').value  = today();

  loadLookups().then(() => loadDashboard());
</script>
</body>
</html>
